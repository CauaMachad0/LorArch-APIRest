<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: template(~{::title}, ~{::main})}">
<head>
    <meta charset="UTF-8">
    <title>Motos</title>
</head>
<body>
<main class="container">
    <h1>Motos</h1>

    <div th:if="${msg}" class="alert alert-success" th:text="${msg}"></div>

    <div class="actions" style="margin:10px 0;">
        <a class="btn" th:href="@{/motos/nova}">Nova moto</a>
    </div>

    <form th:action="@{/motos}" method="get" class="filters">
      <input type="text" name="q" th:value="${param.q}" placeholder="Buscar por placa ou setor"/>
      <button type="submit">Filtrar</button>
    </form>

    <table class="table">
        <thead>
        <tr>
            <th>ID</th>
            <th>Placa</th>
            <th>Status</th>
            <th>Setor</th>
            <th>Ações</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="m : ${motos}">
            <td th:text="${m.id}">1</td>
            <td th:text="${m.placa}">ABC1D23</td>
            <td th:text="${m.status}">DISPONIVEL</td>
            <td th:text="${m.setor}">Operações</td>
            <td style="white-space: nowrap;">
                <a th:href="@{|/motos/${m.id}/editar|}">Editar</a>

                <form th:action="@{|/motos/${m.id}|}" method="post" style="display:inline; margin-left:6px;">
                    <input type="hidden" name="_method" value="delete"/>

                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="link danger" onclick="return confirm('Excluir esta moto?')">Excluir</button>
                </form>

                <form th:if="${m.status?.name() != 'EM_MANUTENCAO'}"
                      th:action="@{|/motos/${m.id}/enviar-manutencao|}" method="post"
                      style="display:inline; margin-left:6px;">

                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit">Enviar p/ manutenção</button>
                </form>

                <form th:if="${m.status?.name() == 'EM_MANUTENCAO'}"
                      th:action="@{|/motos/${m.id}/concluir-manutencao|}" method="post"
                      style="display:inline; margin-left:6px;">
                    <!-- CSRF -->
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit">Concluir manutenção</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <div class="pagination" th:if="${page != null}">
      <a th:if="${!page.first}" th:href="@{/motos(page=${page.number-1}, size=${page.size})}">« Anterior</a>
      <span th:text="${page.number + 1}">1</span> / <span th:text="${page.totalPages}">1</span>
      <a th:if="${!page.last}" th:href="@{/motos(page=${page.number+1}, size=${page.size})}">Próxima »</a>
    </div>

</main>
</body>
</html>
